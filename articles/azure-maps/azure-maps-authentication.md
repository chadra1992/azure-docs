---
title: Authentication methods | Microsoft Azure Maps
description: In this article, you'll learn about Azure Active Directory (Azure AD) and Shared Key authentication. Both are used for Microsoft Azure Maps services. Learn how to get Azure Maps subscription key.
author: philmea
ms.author: philmea
ms.date: 01/28/2020
ms.topic: conceptual
ms.service: azure-maps
services: azure-maps
manager: philmea
ms.custom: mvc
---

# Authentication with Azure Maps

Azure Maps supports two ways to authenticate requests: Shared Key authentication and Azure Active Directory authentication. This article explains these authentication methods to help guide your implementation of Azure Maps services.

> [!NOTE]
> To improve secure communication with Azure Maps, we now support Transport Layer Security (TLS) 1.2, and we're retiring support for TLS 1.0 and 1.1. To avoid any service interruptions, **update your servers and applications to use TLS 1.2 before April 2, 2020**.  If you currently use TLS 1.x, evaluate your TLS 1.2 readiness and develop a migration plan with the testing described in [Solving the TLS 1.0 Problem](https://docs.microsoft.com/security/solving-tls1-problem).

## Shared Key authentication

 Primary and secondary keys are generated after the Azure Maps account is created. You're encouraged to use the primary key as the subscription key when calling Azure Maps using shared key authentication. Shared Key authentication passes a key generated by an Azure Maps account to an Azure Maps service. For each request to Azure Maps services, add the *subscription key* as a parameter to the URL. The secondary key can be used in scenarios like rolling key changes.  

For information about viewing your keys in the Azure portal, see [Manage authentication](https://aka.ms/amauthdetails).

> [!Tip]
> We recommend regenerating your keys regularly. You're provided with two keys, so that you can maintain connections with one key while regenerating the other. When you regenerate your keys, you need to update any applications, that access your account, with the new keys.

## Authentication with Azure Active Directory

Azure Subscriptions are provided with an Azure AD tenant to enable fine grained access control. Azure Maps offers authentication for Azure Maps services using [Azure Active Directory (Azure AD)](https://docs.microsoft.com/azure/active-directory/fundamentals/active-directory-whatis). Azure AD provides identity-based authentication for users and applications registered in the Azure AD tenant. 

## Authorization with Role Based Access Control

What is [role-based access control (RBAC)](https://docs.microsoft.com/azure/role-based-access-control/overview)? 
Azure Maps RBAC is used to authorize access rights for all supported security principal types: User, Application, Managed Identity, and Group. Principal types are granted a set of permissions to REST API actions applied to one or more Azure Maps accounts. The next sections discuss concepts and components of Azure Maps integration with Azure AD role based access control.

## Authentication with Azure AD access tokens

Azure Maps accepts **OAuth 2.0** access tokens for Azure AD tenants associated with an Azure subscription that contains an Azure Maps account. Azure Maps also accepts tokens for:

* Azure AD users
* Partner applications that use permissions delegated by users
* Managed identities for Azure resources

Azure Maps generates a *unique identifier (client ID)* for each Azure Maps account. You can request tokens from Azure AD when you combine this client ID with additional parameters. To request a token, specify the values in the following table based on your Azure Environment.

| Azure Environment   | Azure AD token endpoint |
| --------------------|-------------------------|
| Azure Public        | https://login.microsoftonline.com |
| Azure Government    | https://login.microsoftonline.us |


For more information about how to configure Azure AD and request tokens for Azure Maps, see [Manage authentication in Azure Maps](https://docs.microsoft.com/azure/azure-maps/how-to-manage-authentication).

For general information about authenticating with Azure AD, see [What is authentication?](https://docs.microsoft.com/azure/active-directory/develop/authentication-scenarios).

## Configuring Application Authentication to Azure AD 

Applications will authenticate with the paired Azure AD tenant using one or more supported scenarios provided by Azure AD. Each Azure AD application scenario represents different requirements based on business needs. Some applications may require user sign-in experiences and other applications may require an application sign-in experience. Compreshensive coverage of scenarios are covered in [Microsoft identity platform documentation](https://docs.microsoft.com/en-us/azure/active-directory/develop/authentication-flows-app-scenarios).

After the application receives an access token, the SDK's and/or application sends an HTTPS request with the following set of required HTTP headers in addition to other REST API HTTP headers:

| Header Name       |    Value    |
|:------------------|:------------|
| x-ms-client-id    | 30d7cc….9f55|
| Authorization     | Bearer eyJ0e….HNIVN |

> [!Note]
> `x-ms-client-id` is the Azure Maps account-based GUID that appears on the Azure Maps authentication page.

Here's an example of an Azure Maps route request that uses an Azure AD OAuth Bearer token:

```
GET /route/directions/json?api-version=1.0&query=52.50931,13.42936:52.50274,13.43872 
Host: atlas.microsoft.com 
x-ms-client-id: 30d7cc….9f55 
Authorization: Bearer eyJ0e….HNIVN 
```

For information about viewing your client ID, see [View authentication details](https://aka.ms/amauthdetails).

### Managed identities for Azure resources and Azure Maps

[Managed identities for Azure resources](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/overview) provide Azure services with an automatically managed application based security principal which can authenticate with Azure AD. With RBAC, the managed identity security principal can be authorized to access Azure Maps services. Some examples of managed identities include: Azure App Service, Azure Functions, and Azure Virtual Machines. To discover a comprehensive list of managed identities, see [managed identities for Azure resources](https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/services-support-managed-identities).

## Control access with RBAC

As part of the process to set up your Azure Maps account, an Azure AD directory is associated to the Azure subscription which the Azure Maps account resides. 

Azure Maps supports access to all principal types for Azure RBAC including: individual Azure AD users, groups, applications, Azure resources, and Azure Managed identities. When configuring RBAC a security principal is choosen and applied to a role assignment. To learn how to add role assignments on the Azure portal, see [Add or remove Azure role assignments](https://docs.microsoft.com/en-us/azure/role-based-access-control/role-assignments-portal).

### Picking a Role Definition 

The following role definition types exist to support application scenarios.

| Azure Role Definition |    Description    |
|:-----------------------------|:------------------|
| Azure Maps Data Reader       | Provides access to immutable Azure Maps REST APIs.  |
| Azure Maps Data Contributor  | Provides access to mutable Azure Maps REST APIs. Mutability is defined by the actions: write and delete. |
| Custom Role Definition       | Create a crafted role to enable very restricted access to Azure Maps REST APIs. | 

REST API services may require elevated priviledges to perform write or delete actions. The following table describes where Azure Maps Data Contributor role is required. 

| Azure Maps Service | Azure Maps Role Definition    |
|:------------------------|:-----------------------|
| Render / Map Tiles      | Azure Maps Data Reader |
| Geolocation             | Azure Maps Data Reader |
| Mobility                | Azure Maps Data Reader |
| Route                   | Azure Maps Data Reader |
| Search                  | Azure Maps Data Reader |
| Timezone                | Azure Maps Data Reader |
| Traffic                 | Azure Maps Data Reader |
| Weather                 | Azure Maps Data Reader |
| Data                    | Azure Maps Data Reader, Azure Maps Data Contributor |
| Creator                 | Azure Maps Data Reader, Azure Maps Data Contributor |
| Spatial                 | Azure Maps Data Reader, Azure Maps Data Contributor |

For information about viewing your RBAC settings, see [How to configure RBAC for Azure Maps](https://aka.ms/amrbac).

#### Custom Role Definitions

 One aspect of application security is to apply the principle of least priviledge. The principle implies that the security princpal should only be allowed the access which is required and no other access. Creating custom role definitions can support use cases which require further granularity to access by preventing over provisioning of access for security principal. To read more on Azure custom role definitions, read [Azure Custom Roles](https://docs.microsoft.com/en-us/azure/role-based-access-control/custom-roles).

Here are some possible scenarios where custom roles are beneficial for improved application security.

| Scenario                | Custom Role Data Action(s)    |
|:---------------------------------------------------------------------|:-----------------------|
| A public facing or authentication required web page with base map tiles and no other REST APIs. | `Microsoft.Maps/accounts/services/render/read` |
| An application which only requires access reverse geocoding.             | `Microsoft.Maps/accounts/services/search/read` |
| A role for a security principal which requests **reading** of Creator based map data and base tile data. | `Microsoft.Maps/accounts/services/data/read`, `Microsoft.Maps/accounts/services/render/read` |
| A role for a security principal which requires reading, writing, and deleting of Creator based map data. This may be a organization map editor role but does not allow access to base tile set data. | `Microsoft.Maps/accounts/services/data/read`, `Microsoft.Maps/accounts/services/data/write`, `Microsoft.Maps/accounts/services/data/delete` |

### Understanding Scope

When creating a role assignment it is defined within the Azure resource hierarchy. At the top of the hierachy is a managment group and the the lowest is an Azure resource like an Azure Maps account.

Microsoft's recommendation is assigning access to the Azure Maps account scope because it prevents **unintended access to other Azure Maps accounts** existing in the Azure subscription. 

Assigning a role assignment to a resource group can enable access to multiple Azure Maps resources in the group.

## Next steps

* To learn more about authenticating an application with Azure AD and Azure Maps, see [Manage authentication in Azure Maps](https://docs.microsoft.com/azure/azure-maps/how-to-manage-authentication).

* To learn more about authenticating the Azure Maps Map Control and Azure AD, see [Use the Azure Maps Map Control](https://aka.ms/amaadmc).
